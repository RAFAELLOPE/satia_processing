function [y1] = myNeuralNetworkFunction(x1)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 05-May-2024 18:15:14.
%
% [y1] = myNeuralNetworkFunction(x1) takes these arguments:
%   x = Qx27 matrix, input #1
% and returns:
%   y = Qx4 matrix, output #1
% where Q is the number of samples.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.keep = [1 2 4 5 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27];
x1_step2.xoffset = [0;13;51991800;0;0;225;50;0;0;-695;0;0;225;4994;0;0;-701;0;0;229;4993;0;0;-653;0];
x1_step2.gain = [2.40856485663018e-05;2.33205692084532e-06;6.04631477114699e-07;2.89436438310965e-06;2.00046810953763e-06;8.23913258412154e-06;3.99303614496318e-06;7.2246505075317e-05;7.22517250099346e-05;0.00287769784172662;2;2.00281595923869e-06;8.2100795146201e-06;4.03286787316631e-06;7.20876585928489e-05;7.19605656100457e-05;0.00285306704707561;2;2.00407026671169e-06;8.23238372787032e-06;4.03290853363446e-06;7.19502104543656e-05;7.20980533525595e-05;0.00306278713629403;2];
x1_step2.ymin = -1;

% Layer 1
b1 = [1.3687425417267871097;0.89070711080422271255;-1.0071300750604605945;0.57495639484096894289;-0.096837436200388551932;0.57482258718586254354;0.28184889580856919977;-0.90237682372029792699;-1.2377468643311058116;1.5074005645697243772];
IW1_1 = [-0.48538480248888726809 0.15208389131436941821 0.48030646315442798722 -0.20186701398460951684 0.23503816813178235456 -0.45143642316333432163 0.32015550487362121057 -0.27581161111990165624 0.32855833358660430088 0.024258623886093594324 -0.10330963090513253788 0.53880326342304063481 0.33924404553929904393 -0.56509882563951030487 -0.25665749926787861934 -0.48851442710377873668 0.18826202464978794571 -0.1000322241990438954 0.28090390013064281405 -0.23076025669872057833 -0.31224288000313299429 0.43584517434811737013 -0.27315872258765694358 -0.1215381809505741012 -0.38548869247705980223;0.20172604118050521671 -0.16228949789397525971 -0.37085742219058304148 0.003149923291929701552 -0.07267996350197492017 -0.22884187302954350773 -0.73192967243556694701 -0.075658336187123143013 0.56043878055193663279 0.30070513897320677588 0.046035093934112383818 -0.32087840703907777318 0.048713627092072608882 -0.71175681551957215021 0.3155890186606778447 0.64061657444954578366 -0.12217879698972869407 -0.38315901260657136973 -0.28767508259367180479 0.16666371629193291182 -0.42941215675496385851 -0.15535237667069390355 0.29892998452104491136 -0.10812888125484505786 0.46080660545499924075;0.53201733147640895005 0.02875941963723099154 -0.090175321333890376407 0.14985023844676934046 -0.39288014055816256054 0.075423243416389840199 0.27223537762787064498 0.41656145387715193262 0.046778423326417281625 -0.27190550444444466782 -0.36630965595303466298 -0.21743148478085805309 -0.10006224306608875463 -0.38985888692572356895 0.064071788809280619259 0.22750951551497450298 -0.26527498486051365179 -0.43410419997063404152 -0.52014031939179938835 0.02318366677596647718 -0.28095873497877194014 0.5313096493307319923 0.59536639493937981715 0.55714086915563842961 -0.031402994132799399996;-0.21519972294686032233 -0.20740926540881379769 0.28231081900810467422 -0.31639239666714302768 0.052681683490609851339 0.43974699139746536991 -0.34539021270753800241 -0.39620597077971975164 -0.35774160280973699155 0.14978111681090455765 -0.33178333764885925561 0.17398341580117049343 -0.34240075605556696825 0.39959050009188967767 -0.097811517910742523663 -0.25218346724041112994 -0.073364971547497395687 0.30649971121527685991 -0.066181126686535626802 -0.18442379677484921352 0.45067218686492288571 -0.41227560382925082516 0.39602190929957442611 -0.47008096144992123078 -0.11925284769559224562;0.29939462528388882667 0.065239456121653618959 -0.44569023837861071469 0.42287433955374909011 -0.28716265005084096185 0.2276297778625768764 -0.076715767255343098041 0.14616207056667399056 0.021181427758943827122 -0.43204541885616781771 0.34243377573560218607 -0.4780978047716776258 0.29123702162991399467 0.011944929867380979505 0.11565412695317844882 -0.02449165928269934206 -0.43882422089752232131 0.48946375146558318558 0.10868657142044189923 0.32705527285638918977 0.40515085080765916858 -0.21776386759538413074 -0.063018674374094585389 0.3769273318942521489 0.46305118632460923189;0.30748676253069495701 0.4642839468280616777 -0.013446628472047776268 0.2229035567646912297 -0.25816431351465807253 0.21294705121646395618 0.51414619158254293296 0.088511407481694642785 -0.40371014190333426308 0.34352836716425577679 -0.17335395450725865629 0.18027315426030565693 0.42163242984500737265 0.27634860237375569181 0.44946705563581351717 -0.55491002956196144869 0.25976665437064283548 0.067292101621760580521 -0.47739794836179827442 0.10038850421753828246 0.18641696717914232884 0.23450160481635620724 -0.11372532318258063433 -0.25073604117320491547 0.67890715437072801652;0.20317578395538388181 0.32799905723125577506 0.51852530884101266651 -0.39308973270449693027 0.41838620390306680008 0.12443277737939219263 -0.25918690213923689658 0.34519266797627007337 0.086610854422690120025 0.27575216482187314693 -0.36827926351371198521 -0.15679548568014337051 -0.58855885950117070582 -0.072722867586146280883 0.19230467323472860697 0.4847631783561785479 -0.39594495920810562906 0.092434762833592559739 -0.098318272651532090389 -0.51208359238015677128 -0.11702508302918233907 0.22179607658185290786 -0.1791149917798912361 -0.17329105101433608938 -0.58571304052174699706;-0.40964742865767583835 -0.17394369736745335375 0.22634185225240580075 0.060437876391827252687 0.38158348049705614891 0.2461009478068467704 0.31044079497186288785 0.472335491788929418 -0.090453601527958574224 0.37067586069505936708 0.14111921534220864261 0.31770324496569851691 -0.38010585868941998422 -0.41810398169470397445 -0.15590386715018553221 -0.010947457389749844225 0.37745642939981938202 -0.32238678194452397019 0.17094513933354354984 -0.48547041677108887514 0.019088220761730390063 -0.25868224095266290075 -0.36161274111008756549 -0.042062990544611850163 -0.42031755735417819508;-0.039493744322391818868 0.14504591398336377783 -0.30592158593902568642 0.47389382003762275941 0.26182141176135298455 0.084182638799551692821 0.30543291962650398474 -0.035258043273311494292 -0.10968577893217779096 -0.42423983336591802873 0.50076460330068484073 -0.17496262955884864243 0.52510734738131648047 0.39532435077874489293 -0.22864783470363461704 0.14231477750953694383 0.30638498180997036924 0.067927565226635150397 0.31871367121720167725 -0.16604573064239241953 0.00014671240697646664719 0.57884783634613545811 0.3645430787028973163 0.28347380414104822455 0.19190659905904469684;0.52128029218743565654 -0.17871254580570533621 -0.044674340455055416843 0.33807678502907351215 0.5000630101268248584 -0.51944463025480736018 -0.15205986828655113086 -0.24897337731400712157 0.30891315866584512229 0.48325020995903489318 0.018127081957228272091 -0.22211418033689278584 -0.025372785714140842078 -0.27898508717274178581 -0.035148983611466982913 0.11769315111789681316 0.52699550242252701793 -0.085583068790446109597 -0.23689080416431732012 -0.097555458146844756251 -0.2947841702959496657 0.089361022993912880841 -0.40226295636611891782 -0.35097190600817984585 0.43701682287982818176];

% Layer 2
b2 = [-0.01280391163186197015;1.0492365068818580998;-0.8740841219827650832;-0.48949604584580047595];
LW2_1 = [-0.99107129010196193253 -0.050819607798399016318 1.0307708676583562379 -0.074369744798704395805 0.45115612881623468056 0.36489825844458351201 0.74192453676456171507 -0.48487963069233769309 0.63397363784882310167 -0.06329215614366102971;-0.53570575021649302627 -0.66437752755343482125 -1.2450928963192338106 0.45933475948793095478 0.90204271587821649447 1.2552592293824136327 -0.11804103573505277114 -0.88043489777131556107 -0.062033772626159229546 -0.051311532422992189861;0.14837850713845288086 0.27157074261282498906 -0.24167691321596482257 -0.38163187541961840488 -0.42681606904675273295 -0.79632018789285641258 0.76527776734221197863 -0.75089719119979381201 -0.92900989039050851925 -0.74638105237229235289;0.098076368433490143661 0.76141349978910333185 -0.377362896508317891 0.54068930522315961085 -0.96212341774436271891 -0.86848553564383124126 0.72334305437159429619 0.31043111733674960684 0.96993380189260314239 0.12589863195515976768];

% ===== SIMULATION ========

% Dimensions
Q = size(x1,1); % samples

% Input 1
x1 = x1';
xp1 = removeconstantrows_apply(x1,x1_step1);
xp1 = mapminmax_apply(xp1,x1_step2);

% Layer 1
a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*xp1);

% Layer 2
a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);

% Output 1
y1 = a2;
y1 = y1';
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Remove Constants Input Processing Function
function y = removeconstantrows_apply(x,settings)
y = x(settings.keep,:);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
